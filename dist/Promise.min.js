function Promise(a){function b(a){j===g&&(j=h,f=a,k.forEach(e),k=l=null)}function c(a){j===g&&(j=i,f=a,l.forEach(e),k=l=null)}function d(a,b){j===g?(a&&k.push(a),b&&l.push(b)):j===h?a&&e(a):b&&e(b)}function e(a){setImmediate(function(){a(f)})}if(!(this instanceof Promise))return new Promise(a);var f,g=0,h=1,i=2,j=g,k=[],l=[];this.then=d,a(b,c)}Promise.prototype.pipe=function(a,b){var c=this;return new Promise(function(d,e){c.then(function(b){if(a){var c=a(b);c instanceof Promise?c.then(d,e):d(c)}else d(b)},function(a){if(b){var c=b(a);c instanceof Promise?c.then(d,e):e(c)}else e(a)})})},Promise.prototype.finally=function(a){this.then(a,a)},Promise.deferred=function(){var a={};return a.promise=new Promise(function(b,c){a.resolve=b,a.reject=c}),a},Promise.from=function(a){return a instanceof Promise?a:Promise.resolved(a)},Promise.resolved=function(a){return new Promise(function(b){b(a)})},Promise.rejected=function(a){return new Promise(function(b,c){c(a)})},Promise.timeout=function(a){return new Promise(function(b){setTimeout(b,a)})},Promise.all=function(a){return new Promise(function(b,c){var d,e,f=a.forEach;f?(d=function(a,b){a.forEach(b)},e=new Array(a.length)):(d=function(a,b){for(var c in a)a.hasOwnProperty(c)&&b(a[c],c)},e={});var g=0;d(a,function(a,d){g++,a.then(function(a){e[d]=a,g--,0===g&&b(e)},c)}),0===g&&b(e)})};